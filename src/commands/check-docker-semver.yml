description: >
  This command checks in the semantic version for a repository has been published already in docker.
  This command is used a validation step prior to publishing the new docker image version.

parameters:
  # Required Parameters
  image:
    type: string
    default: ""
    description: |
      The name of the repository on dockerhub
  tag:
    type: string
    default: ""
    description: |
      The semantic version of the project trying to be deployed
      https://semver.org/spec/v2.0.0.html

  # Not Required Parameters
  organization:
    type: string
    default: "cyber4all"
    description: |
      The name of the docker organization

steps:
  - run:
      name: "Verify Parameters"
      command: |
        if [ -z "<<parameters.tag>>" ]; then
          echo '"tag" is missing.'
          exit 1
        fi

        if [ -z "<<parameters.image>>" ]; then
          echo '"image" is missing.'
          exit 1
        fi
  - run:
      name: "Check that semantic version is unique on Dockerhub"
      command: <<include(scripts/check-docker-semver.sh)>>
      environment:
        DOCKER_SEMVER: <<parameters.tag>>
        DOCKER_ORGANIZATION: <<parameters.organization>>
        DOCKER_REPOSITORY: <<parameters.image>>
