description: >
  This command will install v2 of the aws-cli and add IAM programmatic keys to the credentials file.
  This command should be used prior to working with aws orbs or cli commands.

parameters:
  aws-access-key-id:
    default: AWS_ACCESS_KEY_ID
    description: |
      AWS access key id for IAM role. Set this to the name of
      the environment variable you will use to hold this
      value, i.e. AWS_ACCESS_KEY.
    type: env_var_name
  aws-secret-access-key:
    default: AWS_SECRET_ACCESS_KEY
    description: |
      AWS secret key for IAM role. Set this to the name of
      the environment variable you will use to hold this
      value, i.e. $AWS_SECRET_ACCESS_KEY.
    type: env_var_name
  aws-region:
    default: AWS_REGION_N_VA
    description: |
      Env var of AWS region to operate in
      (defaults to AWS_REGION_N_VA)
    type: env_var_name

steps:
  - aws-cli/install
  - run:
      command: >
        if [[ -z "$aws-secret-access-key" ]]; then
          echo '"aws-secret-access-key" not set'
          exit 1
        fi

        if [[ -z "$aws-access-key-id" ]]; then
          echo '"aws-secret-access-key" not set'
          exit 1
        fi
  - aws-cli/setup:
      aws-access-key-id: <<parameters.aws-access-key-id>>
      aws-secret-access-key: <<parameters.aws-secret-access-key>>
      aws-region: <<parameters.aws-region>>
