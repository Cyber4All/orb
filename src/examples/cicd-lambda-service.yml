description: >
  This example shows how a node application being deployed to Lambda
  can setup a CICD pipeline with this orb.

usage:
  version: 2.1

  orbs:
    cyber4all: cyber4all/orb:1.0.0
  
  workflows:
    integration-testing:
      - cyber4all/lint-app:
            docker-image: cimg/node
            isNode: true

      - cyber4all/test-app:
          docker-image: cimg/node
          isNode: true

      - cyber4all/deploy-lambda:
          deploy: false # explicitly shows in develeopment (won't login i.e doesn't need context)
          filters:
            branches:
              ignore: releases

    deploy-production:
      - cyber4all/deploy-lambda:
          deploy: true
          tag: $(cat ./package.json | grep version | head -1 | awk -F= "{ print $2 }" | sed 's/[version:,\",]//g' | tr -d '[[:space:]]')
          function-name: "$FUNCTION_NAME"
          filters:
            branches:
              only: releases